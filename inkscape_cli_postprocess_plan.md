# Inkscape CLI Post-Processing Plan

## Goals
- Automate conversion of generated PDFs so all text becomes outlines and all raster assets are embedded, per @requirements.md#28-44.
- Support both backwall and counter deliverables generated by `create_backwall` and `create_counter`.
- Keep the workflow scriptable so it can run headlessly once Inkscape is installed.

## Prerequisites & Environment
1. **Install Inkscape CLI** (macOS options to document, no action yet):
   - Homebrew cask: `brew install --cask inkscape`
   - DMG download: https://inkscape.org/release/ (ensure version ≥ 1.2 for Actions API).
2. **Capture Inkscape binary path** for scripting (e.g., `/Applications/Inkscape.app/Contents/MacOS/inkscape`).
3. **Confirm output PDFs** are generated via existing Python scripts (`graphics_generator.py`, `backwall_generator.py`, `counter_generator.py`).

## Automation Tasks
1. **Design CLI action recipe**
   - Validate the Inkscape `--actions` sequence required to:
     1. open a PDF,
     2. `select-all` objects,
     3. convert to paths (`object-to-path`),
     4. embed linked images (`extensions.images.embedimages`),
     5. save and close (`file-save;file-close`).
   - Prototype commands manually on a copy of `Backwall_…pdf` and `Counter_…pdf` to confirm output fidelity.

2. **Create reusable Python helper** (likely in `graphics_common.py`):
   - Function signature example: `def postprocess_with_inkscape(pdf_path, inkscape_path, keep_backup=True): ...`
   - Responsibilities:
     - Guard against missing binary (informative error).
     - Run Inkscape CLI Actions for outlining + embedding.
     - Optionally duplicate source PDF before overwriting.
     - Surface stdout/stderr for debugging.

3. **Integrate helper into generators**:
   - Update `create_backwall` in `backwall_generator.py` and `create_counter` in `counter_generator.py` so they can invoke the post-processing step when requested.
   - Add keyword flag (`outline_with_inkscape=False`) or accept an `inkscape_path` argument.
   - Ensure both main entry points (`if __name__ == "__main__"` blocks) document how to enable the automated pass post-export.

4. **Provide orchestration for batch runs**:
   - Update `graphics_generator.generate_all_graphics` (or add a new CLI script) to call backwall + counter generation, then post-process both PDFs sequentially via the helper.
   - Include logging to show each step and highlight the Inkscape command being executed.

5. **Implement safety & cleanup**:
   - Handle temporary files / backups created during CLI invocation.
   - Fail gracefully (keep original PDFs if CLI step fails, emit actionable message).

6. **Verification workflow**:
   - Add a checklist/script to confirm outputs meet specs:
     - Inspect PDFs in a viewer to ensure text is outlined (no selectable text).
     - Use `pdfinfo` or Inkscape metadata to ensure images are embedded.
   - Optionally write a lightweight regression test that mocks the helper to ensure generators call it when enabled.

## Documentation & Handoff
1. **Update README or new section** covering:
   - Required installation steps for Inkscape CLI.
   - Example commands: `python graphics_generator.py --inkscape /path/to/inkscape --outline`.
   - Troubleshooting tips (e.g., PATH issues, Inkscape prompts).
2. **Record CLI command samples** inside the repo (e.g., `docs/inkscape_actions.md`) for future reference.
3. **Align with pre-flight checklist**—note that automated outlining + embedding satisfies the outstanding `[!]` items in both generator scripts.

## Next Actions
1. Confirm desired Inkscape install method and document exact binary path.
2. Draft the helper function signature and update generators with optional CLI parameters.
3. Test the end-to-end flow on both PDFs; refine Actions sequence as needed.
4. Finalize documentation and ensure the automation is opt-in but ready for production.
